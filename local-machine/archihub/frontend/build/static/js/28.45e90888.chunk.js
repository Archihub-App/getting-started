(this.webpackJsonpsim=this.webpackJsonpsim||[]).push([[28],{1063:function(e,t,a){"use strict";a.d(t,"d",(function(){return o})),a.d(t,"h",(function(){return i})),a.d(t,"f",(function(){return s})),a.d(t,"e",(function(){return c})),a.d(t,"g",(function(){return l})),a.d(t,"i",(function(){return u})),a.d(t,"a",(function(){return d})),a.d(t,"b",(function(){return h})),a.d(t,"c",(function(){return m}));var n=a(40),r=a(43);function o(){var e={method:"GET",headers:new Headers({Authorization:Object(r.c)()}),mode:"cors",cache:"default"};return fetch(n.i+"/api/forms/advanced-search",e).then((function(e){return 200!==e.status?Promise.reject(e):e.json()}))}function i(e){var t={method:"GET",headers:new Headers({Authorization:Object(r.c)()}),mode:"cors",cache:"default"},a=n.i+"/api/forms/options/"+e;return fetch(a,t).then((function(e){return 200!==e.status?Promise.reject(e):e.json()}))}function s(e,t){var a={method:"GET",headers:new Headers({Authorization:Object(r.c)()}),mode:"cors",cache:"default"},o=n.i+e.schema.url+t;return fetch(o,a).then((function(e){return 200!==e.status?Promise.reject(e):e.json()}))}function c(){var e={method:"GET",headers:new Headers({Authorization:Object(r.c)()}),mode:"cors",cache:"default"};return fetch(n.i+"/forms",e).then((function(e){return 200!==e.status?Promise.reject(e):e.json()}))}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=new Headers({Authorization:Object(r.c)(),"Content-Type":"application/json"}),o="/forms/"+e,i={method:"POST",headers:a,mode:"cors",cache:"default",body:JSON.stringify(t)};return fetch(n.i+o,i).then((function(e){return 200!==e.status?Promise.reject(e):e.json()}))}function u(e,t){var a="/forms/"+e,o={method:"PUT",headers:new Headers({Authorization:Object(r.c)(),"Content-Type":"application/json"}),mode:"cors",cache:"default",body:t};return fetch(n.i+a,o).then((function(e){return 200!==e.status?Promise.reject(e):e.json()}))}function d(e){var t={method:"POST",headers:new Headers({Authorization:Object(r.c)(),"Content-Type":"application/json"}),mode:"cors",cache:"default",body:e};return fetch(n.i+"/forms",t).then((function(e){return 201!==e.status?Promise.reject(e):e.json()}))}function h(e){var t="/forms/"+e,a={method:"DELETE",headers:new Headers({Authorization:Object(r.c)()}),mode:"cors",cache:"default"};return fetch(n.i+t,a).then((function(e){if(204!==e.status)return Promise.reject(e)}))}function m(e){var t="/forms/duplicate/"+e,a={method:"POST",headers:new Headers({Authorization:Object(r.c)(),"Content-Type":"application/json"}),mode:"cors",cache:"default"};return fetch(n.i+t,a).then((function(e){if(201!==e.status)return Promise.reject(e)}))}},1245:function(e,t,a){"use strict";a.d(t,"c",(function(){return o})),a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return s}));a(8),a(19),a(267);var n=a(211),r=a.n(n),o=(a(1376),function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}),i=function(e){return"[object Array]"===Object.prototype.toString.call(e)},s=function(e){var t=e.error,a=e.text,n=e.confirmButtonText,o=e.action;401==t?console.log(t):r.a.fire({title:t,text:a,icon:"error",confirmButtonText:n}).then((function(e){o()}))}},1290:function(e,t,a){"use strict";a.d(t,"b",(function(){return h}));var n=a(35),r=a(2),o=a.n(r),i=a(512),s=a(516),c=a(99),l=a(267),u=a(362),d=(a(1315),a(365)),h=Object(i.a)((function(e){return{root:{backgroundColor:"rgba(255, 255, 255, 0.5)",backdropFilter:"blur(20px)",borderRadius:"10px",width:"100%",maxWidth:"900px",marginTop:"20vh",boxShadow:"0px 0px 10px 0px rgba(0,0,0,0.15)"},items:{display:"flex",justifyContent:"center",flexWrap:"wrap",padding:25},item:{width:130,height:130,backgroundColor:"white",borderRadius:"10px",cursor:"pointer",transform:"scale(1)",transition:"0.2s ease all",display:"flex",justifyContent:"center",alignItems:"center",alignContent:"flex-start",flexWrap:"wrap",margin:10,"&.undo":{backgroundColor:"#a7b7cb",color:"white","& svg":{backgroundColor:"rgba(255, 255, 255, 0.3)","& path":{fill:"white"}},"& h3":{color:"white"}},"& svg":{backgroundColor:"rgba(150, 150, 150, 0.1)",height:70,paddingTop:20,paddingBottom:20,borderRadius:10,marginBottom:5},"& h3":{width:"100%",color:"#2A5080",fontWeight:"bold",fontSize:13,textAlign:"center",padding:5},"&:hover":{transform:"scale(1.1)"}}}}));t.a=function(){var e=h(),t=c.a.getState().auth.user.roles,a=Object(r.useState)(null),i=Object(n.a)(a,2),m=i[0],p=i[1];return o.a.createElement(s.a,{className:e.root},o.a.createElement(s.a,{className:e.items},!m&&d.a.elements.map((function(a,n){if(Object(l.intersection)(a.roles,t).length>0)return o.a.createElement(s.a,{key:n,className:e.item,onClick:function(){a.children.length>0?p(a.children):window.location.href=a.route}},Object(u.a)(a,"",{width:"100%",fontSize:50,color:"#2A5080"}),o.a.createElement("h3",null,a.tag))})),m&&o.a.createElement(s.a,{className:"".concat(e.item," undo"),onClick:function(){p(null)}},Object(u.a)({material_icon:"Undo",tag:"Volver"},"",{width:"100%",fontSize:60,color:"#2A5080"}),o.a.createElement("h3",null,"Volver")),m&&m.map((function(a,n){if(Object(l.intersection)(a.roles,t).length>0)return o.a.createElement(s.a,{key:n,className:e.item,onClick:function(){a.route&&(window.location.href=a.route)}},console.log(a),Object(u.a)(a,"",{width:"100%",fontSize:60,color:"#2A5080"}),o.a.createElement("h3",null,a.tag))}))))}},1291:function(e,t,a){"use strict";a.d(t,"f",(function(){return i})),a.d(t,"b",(function(){return s})),a.d(t,"d",(function(){return c})),a.d(t,"c",(function(){return l})),a.d(t,"a",(function(){return u})),a.d(t,"e",(function(){return d}));var n=a(40),r=a(43),o=a(1004);function i(){var e=new Headers({"Content-Type":"application/json",Authorization:Object(r.c)()}),t="/api/resource-groups/first-level-cache",a={method:"GET",headers:e,mode:"cors",cache:"default"};return fetch(n.i+t,a).then((function(e){return 200!==e.status?Promise.reject(e.status):e.json()}))}function s(e){var t="/api/resource-groups/get-all-children?ident="+e,a={method:"GET",headers:new Headers({"Content-Type":"application/json",Authorization:Object(r.c)()}),mode:"cors",cache:"default"};return fetch(n.i+t,a).then((function(e){return 200!==e.status?Promise.reject(e.status):e.json()}))}function c(e){var t="/api/resource-groups/recursive-metadata/"+e,a={method:"GET",headers:new Headers({"Content-Type":"application/json",Authorization:Object(r.c)()}),mode:"cors",cache:"default"};return fetch(n.i+t,a).then((function(e){return 200!==e.status?Promise.reject(e.status):e.json()}))}function l(e){var t="/api/resource-groups/metadata/"+e,a={method:"GET",headers:new Headers({"Content-Type":"application/json",Authorization:Object(r.c)()}),mode:"cors",cache:"default"};return fetch(n.i+t,a).then((function(e){return 200!==e.status?Promise.reject(e.status):e.json()}))}function u(e){var t="/api/resource-groups/"+e,a={method:"DELETE",headers:new Headers({Authorization:Object(r.c)()}),mode:"cors",cache:"default"};return fetch(n.i+t,a).then((function(e){return 200!==e.status?Promise.reject(e.status):e.json()}))}a.n(o)()(document).ajaxSend((function(e,t,a){t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Authorization",Object(r.c)())}));function d(e){var t="/api/resource-groups/simple/"+e,a={method:"GET",headers:new Headers({Authorization:Object(r.c)()}),mode:"cors",cache:"default"};return fetch(n.i+t,a).then((function(e){return[200,304].includes(e.status)?e.json():Promise.reject(e.status)}))}},1315:function(e,t,a){"use strict";a(35);var n=a(92),r=a(212),o=a(213),i=a(342),s=a(216),c=a(217),l=a(2),u=a.n(l),d=a(56),h=a(38),m=a(983),p=a(151),f=a(1291),g=a(1063),v=a(1314);var b=function(e){return u.a.createElement("div",{className:"cev-custom-textarea"},e.tags&&e.tags.length>0&&e.tags.map((function(t,a){return u.a.createElement(u.a.Fragment,{key:"r-".concat(a)},0===e.currentPosition&&0===a&&u.a.createElement("input",{autoFocus:!0,type:"text",className:"form-control",onKeyDown:function(t){e.events.onKeyDown(t)},onChange:function(t){e.events.onChange(t)}}),u.a.createElement("button",{type:"button",className:"cev-close-button",key:a,onClick:function(t){e.events.deleteTag(a)}},t),e.currentPosition>0&&a===e.currentPosition-1&&u.a.createElement("input",{autoFocus:!0,type:"text",className:"form-control",onKeyDown:function(t){e.events.onKeyDown(t)},onChange:function(t){e.events.onChange(t)}}))})),0===e.tags.length&&u.a.createElement("input",{autoFocus:!0,type:"text",className:"form-control",onKeyDown:function(t){e.events.onKeyDown(t)},onChange:function(t){e.events.onChange(t)}}))},y=a(2127),E=a(2128),j=a(2103),S=a(905),O=a(2102),w=u.a.forwardRef((function(e,t){return u.a.createElement("div",{ref:t,onClick:function(t){t.preventDefault(),e.onClick(t)},onMouseOver:function(t){t.preventDefault(),e.onMouseOver&&e.onMouseOver(t)}},e.children)})),k=a(19),N=a(2144),x=a(2159),C=a(2145),T=a(1590),_=a(1201),A=a.n(_),R=a(267),P=a.n(R),D=a(1589),M=(a(179),a(40)),F=a(43);var G=a(2101),L=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e))._onEdited=function(e){n._onChange()},n._onCreated=function(e){n._onChange()},n._onDeleted=function(e){n._onChange()},n._editableFG=null,n._onFeatureGroupReady=function(e){if(e){var t=new A.a.GeoJSON({type:"FeatureCollection",features:[]}),a=e.leafletElement;t.eachLayer((function(e){a.addLayer(e)})),n._editableFG=e}},n._onChange=function(){var e=n.props.onChange;if(n._editableFG&&e){var t=n._editableFG.leafletElement.toGeoJSON();n.setState({selected:!1},(function(){n.props.onChange("Pol\xedgono",t)}))}},n.state={z:n.props.zoom?n.props.zoom:5,c:n.props.center?n.props.center:[4.36,-74.04],anteriorH:-1,anteriorW:-1,minHeigth:n.props.minHeigth?n.props.minHeigth:350,levels:[{label:"Macroregi\xf3n",value:3},{label:"Departamento",value:1},{label:"Municipio",value:2}],level:void 0,selected:void 0,locationsValue:void 0},n}return Object(o.a)(a,[{key:"update",value:function(){var e=this;setTimeout((function(){var t=e.map;if(null!=t){var a=t.clientHeight;a<e.state.minHeigth&&(a=e.state.minHeigth),-1!==e.state.anteriorH&&0!==e.state.anteriorH&&-1!==e.state.anteriorW&&0!==e.state.anteriorW||e.setState({height:a,width:t.clientWidth,anteriorH:t.clientHeight,anteriorW:t.clientWidth},(function(){e.updateLocations()}))}}),1)}},{key:"componentDidUpdate",value:function(e,t){var a=this,n=this.map;n.clientHeight>0&&n.clientWidth>0&&(0===this.state.height||0===this.state.width)&&setTimeout((function(){a.setState({height:n.clientHeight,width:n.clientWidth,anteriorH:n.clientHeight,anteriorW:n.clientWidth})}),500)}},{key:"componentDidMount",value:function(){this.update()}},{key:"updateLocations",value:function(){var e=this;(function(e,t){var a="/api/admin/locations?"+(e=e?"q="+e:"")+"&skip="+2e3*(t-1)+"&limit=2000",n={method:"GET",headers:new Headers({Authorization:Object(F.c)()}),mode:"cors",cache:"default"};return fetch(M.i+a,n).then((function(e){return 200!==e.status?Promise.reject(e.status):e.json()}))})("",1).then((function(t){var a=t.map((function(e){return 1===e.admin_level||2===e.admin_level?Object(k.a)({},{_id:e._id,admin_level:e.admin_level,dpto:e.properties.DPTO,nombre_dpt:e.properties.NOMBRE_DPT,mpio:e.properties.MPIO?e.properties.MPIO:"",nombre_mpi:e.properties.NOMBRE_MPI?e.properties.NOMBRE_MPI:"",nombre_cab:e.properties.NOMBRE_CAB?e.properties.NOMBRE_CAB:"",clasemun:e.properties.CLASEMUN?e.properties.CLASEMUN:"",mpios:e.properties.MPIOS?e.properties.MPIOS:"",zona:e.properties.ZONA?e.properties.ZONA:"",of_reg:e.properties.OF_REG?e.properties.OF_REG:"",reg_zonas:e.properties.REG_ZONAS?e.properties.REG_ZONAS:"",area:e.properties.AREA,perimeter:e.properties.PERIMETER,hectares:e.properties.HECTARES,poligon:e.geometry,pais:e.pais,localidad:e.localidad,value:e._id,label:e.properties.NOMBRE_DPT+(e.properties.NOMBRE_MPI?" - "+e.properties.NOMBRE_MPI:"")}):3===e.admin_level?Object(k.a)({},{_id:e._id,admin_level:e.admin_level,nombre_dpt:e.properties.NOMBRE_MR,area:e.properties.AREA,poligon:e.geometry,value:e._id,label:e.properties.NOMBRE_MR}):e}));e.setState({locations:a})}))}},{key:"addNew",value:function(e,t,a){var n=this._editableFG;if(n){var r={type:"FeatureCollection",features:[]};r.features.push(t);var o=new A.a.GeoJSON(r),i=n.leafletElement;o.eachLayer((function(e){i.addLayer(e)}));var s=n.leafletElement.toGeoJSON();this._editableFG=n,this.props.onChange(e,s,a)}}},{key:"clear",value:function(){var e=this,t=this._editableFG.leafletElement._layers;Object.keys(t).forEach((function(a,n){var r=t[a];e._editableFG.leafletElement.removeLayer(r)})),this.props.clear()}},{key:"unselect",value:function(){var e=this;this.setState({selected:void 0,levelsValue:-1,locationsValue:-1,level:void 0},(function(){e.clear()}))}},{key:"select",value:function(){this.props.onAdd(this.state),this.setState({selected:!0})}},{key:"locationChange",value:function(e){var t=this,a=e.value;this.setState({locationsValue:e,loading:!0},(function(){t.clear(),function(e){var t="/api/admin/locations/"+e,a={method:"GET",headers:new Headers({Authorization:Object(F.c)()}),mode:"cors",cache:"default"};return fetch(M.i+t,a).then((function(e){return 200!==e.status?Promise.reject(e.status):e.json()}))}(a).then((function(e){1===e.admin_level&&t.addNew(e.properties.NOMBRE_DPT,e.geometry,e._id),2===e.admin_level&&t.addNew(e.properties.NOMBRE_DPT+" "+e.properties.NOMBRE_MPI,e.geometry,e._id),3===e.admin_level&&t.addNew(e.properties.NOMBRE_MR,e.geometry,e._id),t.setState({selected:!1,loading:!1})}))}))}},{key:"levelChange",value:function(e){this.setState({level:e,locationsValue:null,selected:void 0})}},{key:"render",value:function(){var e=this,t=this.state,a=t.level,n=t.locationsValue,r=this.state.level?this.state.level.value:this.state.level,o=P.a.orderBy(P.a.filter(this.state.locations,{admin_level:r}),["nombre_dpt","nombre_mpi"]);return u.a.createElement("div",{className:"map"},u.a.createElement("div",{className:"space"}),u.a.createElement("div",{ref:function(t){return e.map=t},className:"mw-100"},this.state.height&&u.a.createElement(N.a,{style:{width:this.state.width,height:this.state.height},center:this.state.c,zoom:this.state.z,scrollWheelZoom:!1},u.a.createElement(x.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),u.a.createElement(C.a,{ref:function(t){e._onFeatureGroupReady(t)}},void 0===this.state.selected&&!this.state.selected&&u.a.createElement(T.a,{position:"topright",onEdited:this._onEdited,onCreated:function(t){e._onCreated(t)},onDeleted:function(t){e._onDeleted(t)},draw:{polyline:!1,polygon:!0,rectangle:!1,circle:!1,circlemarker:!1,marker:!1}}))),!this.state.selected&&u.a.createElement(u.a.Fragment,null,u.a.createElement(D.a,{value:this.state.level,onChange:function(t){e.levelChange(t)},options:this.state.levels,placeholder:"Seleccione nivel"}),this.state.level&&u.a.createElement(D.a,{value:this.state.locationsValue,onChange:function(t){return e.locationChange(t)},options:o,placeholder:"Seleccione el pol\xedgono"})),this.state.loading&&u.a.createElement(u.a.Fragment,null,u.a.createElement(G.a,{fluid:!0,className:"my-5"},u.a.createElement(O.a,{variant:"success"},u.a.createElement("div",{className:"alert-icon"},u.a.createElement("i",{className:"fas fa-sync fa-spin"})),u.a.createElement("div",{className:"alert-text"},"Cargando...")))),void 0!==this.state.selected&&!this.state.selected&&-1!==this.state.locationsValue&&!this.state.loading&&u.a.createElement("div",null,u.a.createElement("button",{type:"button",onClick:function(){return e.select()},className:"btn btn-success"},"Seleccionar")),this.state.selected&&u.a.createElement(u.a.Fragment,null,u.a.createElement("div",null,u.a.createElement("button",{type:"button",onClick:function(){return e.unselect()},className:"btn btn-danger"},"Borrar")),u.a.createElement("div",{className:""},u.a.createElement("i",{className:"flaticon2-map"}),"Mapa seleccionado: ",a.label+" - "+n.label))))}}]),a}(l.Component);var z=Object(d.b)((function(e){return{searchFilters:e.app.filters}}))(L),q=a(1337),H=a.n(q),B=a(1511),Q=a.n(B),I=a(1142),V=a.n(I),W=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={newLabel:"",show:!1,alert:!1,form:void 0,isLoading:!1},n}return Object(o.a)(a,[{key:"componentDidMount",value:function(){this.setState({oldLabel:this.props.label,newLabel:this.props.label,show:!1})}},{key:"selectForm",value:function(e){var t=this,a=this.props.config.forms[e.target.value];void 0!==a?"form-select"===a.type?g.h(a.field).then((function(e){if(e.aggregations.options.buckets.length>0){var n=P.a.map(e.aggregations.options.buckets,"key");n.length>20?(a.type="autocomplete",a.data=n):a.schema.properties[a.name].enum=n}else a.schema.properties[a.name].enum=["Sin Registros"];a.schema.properties[a.name].enum=a.schema.properties[a.name].enum.sort(),t.setState({form:a})})):this.setState({form:a}):this.setState({form:null})}},{key:"onChange",value:function(e){if(e.selected.length>0){var t=e.selected[0],a=this.state.form.queryAlias?this.state.form.queryAlias:this.state.form.query;a=a.split("["+this.state.form.name+"]").join(t),this.setState({query:a,formData:t})}}},{key:"onClick",value:function(){var e=this.state.query;this.setState({show:!1,form:void 0},this.props.addQuery(e))}},{key:"onSubmit",value:function(e,t){t.preventDefault();var a=this.state.form.queryAlias?this.state.form.queryAlias:this.state.form.query;if("object"===typeof e)for(var n in e)"Sin Registros"!==e[n]&&(a=a.split("["+n+"]").join(e[n]));else a=e;a!==this.state.form.query?this.setState({query:a,formData:e,show:!1,form:void 0},this.props.addQuery(a)):console.log("No se puede agregar registro")}},{key:"asyncSearch",value:function(e){var t=this;this.setState({isLoading:!0}),g.f(this.state.form,e).then((function(e){t.setState({isLoading:!1,options:e.items})}))}},{key:"mapSelect",value:function(e){this.setState({mapData:e})}},{key:"mapAdd",value:function(){var e="",t="";P.a.map(this.state.mapData.features,(function(a,n){e+=t+a.geometry.type[0]+"_";var r="";P.a.map(a.geometry.coordinates,(function(t,a){e+=r+t,r="-"})),t="|"})),this.setState({show:!1,form:void 0},this.props.addMap(this.state.mapData,e))}},{key:"render",value:function(){var e=this,t=this.state,a=t.show,n=t.alert,r=this.props.showSearchBar?"":"cev-advancedform";return u.a.createElement(y.a,{drop:"down",show:a,onToggle:function(){e.setState({show:!1})}},u.a.createElement(y.a.Toggle,{as:w,onClick:function(){e.setState({show:!0})}},u.a.createElement("button",{title:"B\xfasqueda avanzada",type:"button",className:"btn-small ml-2 btn btn-primary"},u.a.createElement(Q.a,null))),u.a.createElement(y.a.Menu,{flip:"false",className:"dropdown-menu-fit dropdown-menu-left dropdown-menu-anim dropdown-menu-xl ".concat(r," advanceSearch")},u.a.createElement("div",{className:"cev-portlet"},u.a.createElement("div",{className:"cev-portlet__head-title"},u.a.createElement("h3",null,"Agregar b\xfasqueda"),u.a.createElement("button",{type:"button",className:"btn-small ml-2 btn btn-danger",onClick:function(){e.setState({show:!1})}},u.a.createElement(V.a,null))),u.a.createElement("div",{className:"cev-portlet__head-toolbar"},(!this.props.config||!this.props.config.forms)&&u.a.createElement("span",null,"Cargando configuraci\xf3n de formularios"),this.props.config&&this.props.config.forms&&u.a.createElement("select",{onChange:function(t){return e.selectForm(t)}},u.a.createElement("option",{value:"-1"},"Seleccione una opci\xf3n"),this.props.config.forms.map((function(e,t){return u.a.createElement("option",{key:t,value:t},e.title)})))),u.a.createElement("div",{className:"cev-portlet__body"},u.a.createElement("div",{className:"input-group"},this.state.form&&("form"===this.state.form.type||"form-select"===this.state.form.type)&&u.a.createElement(H.a,{schema:this.state.form.schema,uiSchema:this.state.form.uiSchema,widgets:this.state.form.widgets,fields:this.state.form.fields,onSubmit:function(t,a){var n=t.formData;a.preventDefault(),e.onSubmit(n,a)}},u.a.createElement("div",null,u.a.createElement("button",{type:"submit",className:"btn btn-success"},"Agregar"))),this.state.form&&"autocomplete"===this.state.form.type&&u.a.createElement(E.a.Group,{className:"w-100 mb-10"},u.a.createElement(j.a,null,u.a.createElement(v.a,{id:"autocompletado",paginate:!0,defaultOpen:!0,options:this.state.form.data,onChange:function(t){return e.onChange({selected:t})}}),u.a.createElement(j.a.Append,null,u.a.createElement(S.a,{onClick:function(){return e.onClick()},variant:"outline-secondary"},"Agregar")))),this.state.form&&"map"===this.state.form.type&&u.a.createElement(z,{addQuery:this.props.addQuery,onChange:function(t){e.mapSelect(t)},onAdd:function(){e.mapAdd()}})),u.a.createElement(O.a,{variant:"danger",show:n},"Introduzca datos")))))}}]),a}(u.a.Component),K=Object(d.b)((function(e){return{user:e.auth.user._id,showSearchBar:e.app.showSearch}}))(W),J=(a(104),a(1512)),U=a.n(J),Z=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={newLabel:"",show:!1,alert:!1,form:void 0,isLoading:!1},n.validate=n.validate.bind(Object(i.a)(n)),n}return Object(o.a)(a,[{key:"componentDidMount",value:function(){this.setState({oldLabel:this.props.label,newLabel:this.props.label,show:!1})}},{key:"validate",value:function(e){e.preventDefault()}},{key:"selectForm",value:function(e){var t=this,a=this.props.config.forms[e.target.value];void 0!==a?"form-select"===a.type?g.h(a.field).then((function(e){e.aggregations.options.buckets.length>0?a.schema.properties[a.name].enum=P.a.map(e.aggregations.options.buckets,"key"):a.schema.properties[a.name].enum=["Sin Registros"],a.schema.properties[a.name].enum=a.schema.properties[a.name].enum.sort(),t.setState({form:a})})):this.setState({form:a}):this.setState({form:null})}},{key:"change",value:function(e){}},{key:"onSubmit",value:function(e,t){t.preventDefault();var a=this.state.form.queryAlias?this.state.form.queryAlias:this.state.form.query;if("object"===typeof e)for(var n in e)console.log(n,e[n]),"Sin Registros"!==e[n]&&(a=a.split("["+n+"]").join(e[n]));else a=e;a!==this.state.form.query?this.setState({query:a,formData:e,show:!1,form:void 0},this.props.addQuery(a)):console.log("No se puede agregar registro")}},{key:"asyncSearch",value:function(e){var t=this;this.setState({isLoading:!0}),g.f(this.state.form,e).then((function(e){t.setState({isLoading:!1,options:e.items})}))}},{key:"mapSelect",value:function(e,t,a){this.setState({mapData:t,nameMap:e,mapId:a})}},{key:"mapAdd",value:function(){if("Pol\xedgono"===this.state.nameMap){var e="",t="";P.a.map(this.state.mapData.features,(function(a,n){e+=t+a.geometry.type[0]+"_";var r="";P.a.map(a.geometry.coordinates,(function(t,a){e+=r+t,r="-"})),t="|"})),this.setState({show:!1,form:void 0},this.props.addMap(this.state.mapData,e,this.state.nameMap))}else this.setState({show:!1,form:void 0},this.props.addMap(this.state.mapData,"M_"+this.state.mapId,this.state.nameMap))}},{key:"render",value:function(){var e=this,t=this.state.show,a=this.props.showSearchBar?"":"cev-advancedform";return u.a.createElement(y.a,{drop:"down",show:t,onToggle:function(){e.setState({show:!1})}},u.a.createElement(y.a.Toggle,{as:w,onClick:function(){e.setState({show:!0})}},u.a.createElement("button",{type:"button",className:"btn-small ml-2 btn btn-primary",title:"Busqueda por cobertura geogr\xe1fica"},u.a.createElement(U.a,null))),u.a.createElement(y.a.Menu,{flip:"false",className:"dropdown-menu-fit dropdown-menu-left dropdown-menu-anim dropdown-menu-xl ".concat(a," advanceSearch")},u.a.createElement("div",{className:"cev-portlet"},u.a.createElement("h3",null,"B\xfasqueda por cobertura geogr\xe1fica"),u.a.createElement("div",{className:"cev-portlet__body"},u.a.createElement(z,{addQuery:this.props.addQuery,onChange:function(t,a,n){e.mapSelect(t,a,n)},onAdd:function(t){e.mapAdd(t)},clear:function(){e.props.addMap(void 0,void 0,void 0)}})))))}}]),a}(u.a.Component),Y=Object(d.b)((function(e){return{user:e.auth.user._id,showSearchBar:e.app.showSearch}}))(Z),X=a(877),$=a(176),ee=a(2037),te=a(1002),ae=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(o.a)(a,[{key:"componentDidMount",value:function(){this.svg=te.l(this.refs.d3_canvas),this.updateViz()}},{key:"updateViz",value:function(){var e=this,t=10,a=10,n=10,r=10,o=te.g().domain(te.f(this.props.data.length)).range([n,550-r]).padding(.1),i=te.h().domain([0,te.d(this.props.data,(function(e){return e.value}))]).nice().range([200-t,a]),s=te.l("body").append("div").attr("class","d3-tooltip").style("opacity",0);return this.svg.attr("viewBox",[0,0,540,200]),this.svg.append("g").attr("fill","steelblue").attr("transform","translate(0,-10)").selectAll("rect").data(this.props.data).join("rect").attr("x",(function(e,t){return o(t)})).attr("y",(function(e){return i(e.value)})).attr("height",(function(e){return i(0)-i(e.value)})).attr("width",o.bandwidth()).on("mouseover",(function(e){s.transition().duration(200).style("opacity",.9),s.html("A\xf1o: "+e.name+"<br/>Registros: "+e.data).style("left",te.c.pageX+"px").style("top",te.c.pageY-28+"px")})).on("mouseleave",(function(e){s.transition().duration(500).style("opacity",0)})),this.svg.append("g").call((function(a){return a.attr("transform","translate(0,".concat(200-t-10,")")).style("font-size","8px").call(te.b(o).tickFormat((function(t){return e.props.data[t].name})).tickSizeOuter(0))})),this.svg.node()}},{key:"render",value:function(){return u.a.createElement(u.a.Fragment,null,u.a.createElement("svg",{ref:"d3_canvas",width:"550",height:"200",viewBox:"0 0 630 200"}))}}]),a}(l.Component);var ne=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={value:[0,100],valuetext:"",min:0,max:100,marks:[]},n.valueLabelFormat=n.valueLabelFormat.bind(Object(i.a)(n)),n}return Object(o.a)(a,[{key:"valueLabelFormat",value:function(e){return this.state.marks[e].label}},{key:"handleChange",value:function(e,t){this.setState({value:t})}},{key:"normalizeData",value:function(e){var t=100/e.length;return(e=e.sort((function(e,t){return e.value-t.value}))).map((function(e,a){return 0===a?{name:e.name,value:3*t,data:e.value}:{name:e.name,value:3*a*t,data:e.value}})).sort((function(e,t){return e.name-t.name}))}},{key:"componentDidMount",value:function(){var e=this;(function(e){var t={method:"POST",headers:new Headers({"Content-Type":"application/json",Authorization:Object(F.c)()}),mode:"cors",cache:"default",body:JSON.stringify(e)};return fetch(M.i+"/api/viz/getHistogramDates",t).then((function(e){return 200!==e.status?Promise.reject(e.status):e.json()}))})({}).then((function(t){console.log("Datos visualizaci\xf3n");var a=[],n=0,r=P.a.map(t.aggregations.resource_by_month.buckets,(function(e,t){return 0!==e.doc_count&&(a.push({value:n,label:new Date(e.key).getUTCFullYear()}),n++),{name:new Date(e.key).getUTCFullYear(),value:e.doc_count}})).filter((function(e){return 0!==e.value}));r.length>0&&e.setState({histogramData:e.normalizeData(r),max:r.length-1,value:[0,r.length-1],marks:a})}),(function(e){console.log("Error en la consulta getHistogramDates"),console.log(e)}))}},{key:"addSearch",value:function(){var e=new Date(this.state.marks[this.state.value[0]].label+"-01-01"),t=new Date(this.state.marks[this.state.value[1]].label+"-12-31");this.props.addQuery("temporal.inicio: ["+e.toISOString().substring(0,10)+" TO "+t.toISOString().substring(0,10)+"]")}},{key:"addSearchWithout",value:function(){this.props.addQuery("!_exists_:temporal.inicio")}},{key:"render",value:function(){var e=this,t=this.props.classes;return u.a.createElement("div",{className:t.root},this.state.histogramData&&u.a.createElement(u.a.Fragment,null,u.a.createElement($.a,{id:"range-slider",gutterBottom:!0},"Cobertura temporal"),u.a.createElement(ae,{data:this.state.histogramData}),u.a.createElement(ee.a,{value:this.state.value,onChange:function(t,a){e.handleChange(t,a)},"aria-labelledby":"range-slider",valueLabelDisplay:"on",min:this.state.min,max:this.state.max,getAriaValueText:this.valueLabelFormat,valueLabelFormat:this.valueLabelFormat,marks:this.state.marks}),u.a.createElement("button",{type:"button",className:"btn btn-success btn-sm",onClick:function(){e.addSearch()}},u.a.createElement("i",{className:"flaticon2-plus"}," Agregar rango fechas")),u.a.createElement("button",{type:"button",className:"btn btn-warning btn-sm",onClick:function(){e.addSearchWithout()}},u.a.createElement("i",{className:"flaticon2-plus"},"Sin Cobertura"))))}}]),a}(l.Component),re=Object(X.a)((function(e){return{root:{width:550,background:"#fffe"}}}))(ne),oe=a(1513),ie=a.n(oe),se=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={newLabel:"",show:!1,alert:!1,form:void 0,isLoading:!1},n.validate=n.validate.bind(Object(i.a)(n)),n}return Object(o.a)(a,[{key:"componentDidMount",value:function(){this.setState({oldLabel:this.props.label,newLabel:this.props.label,show:!1})}},{key:"validate",value:function(e){e.preventDefault()}},{key:"selectForm",value:function(e){var t=this,a=this.props.config.forms[e.target.value];void 0!==a?"form-select"===a.type?g.h(a.field).then((function(e){e.aggregations.options.buckets.length>0?a.schema.properties[a.name].enum=P.a.map(e.aggregations.options.buckets,"key"):a.schema.properties[a.name].enum=["Sin Registros"],a.schema.properties[a.name].enum=a.schema.properties[a.name].enum.sort(),t.setState({form:a})})):this.setState({form:a}):this.setState({form:null})}},{key:"onSubmit",value:function(e,t){t.preventDefault();var a=this.state.form.queryAlias?this.state.form.queryAlias:this.state.form.query;if("object"===typeof e)for(var n in e)console.log(n,e[n]),"Sin Registros"!==e[n]&&(a=a.split("["+n+"]").join(e[n]));else a=e;a!==this.state.form.query?this.setState({query:a,formData:e,show:!1,form:void 0},this.props.addQuery(a)):console.log("No se puede agregar registro")}},{key:"asyncSearch",value:function(e){var t=this;this.setState({isLoading:!0}),g.f(this.state.form,e).then((function(e){t.setState({isLoading:!1,options:e.items},(function(){console.log("El estado ahora es ",t.state)}))}))}},{key:"mapSelect",value:function(e){this.setState({mapData:e})}},{key:"mapAdd",value:function(){var e="",t="";P.a.map(this.state.mapData.features,(function(a,n){e+=t+a.geometry.type[0]+"_";var r="";P.a.map(a.geometry.coordinates,(function(t,a){e+=r+t,r="-"})),t="|"})),this.setState({show:!1,form:void 0},this.props.addMap(this.state.mapData,e))}},{key:"render",value:function(){var e=this,t=this.state.show,a=this.props.showSearchBar?"":"cev-advancedform";return u.a.createElement(y.a,{drop:"down",show:t,onToggle:function(){e.setState({show:!1})},flip:"false"},u.a.createElement(y.a.Toggle,{as:w,onClick:function(){e.setState({show:!0})}},u.a.createElement("button",{type:"button",className:"btn-small ml-2 btn btn-primary",title:"B\xfasqueda por fecha"},u.a.createElement(ie.a,null))),u.a.createElement(y.a.Menu,{flip:"false",className:"dropdown-menu-fit dropdown-menu-left dropdown-menu-anim dropdown-menu-xl ".concat(a," advanceSearch")},u.a.createElement("div",{className:"cev-portlet"},u.a.createElement("div",{className:"cev-portlet__head"},u.a.createElement("div",{className:"cev-portlet__head-label"},u.a.createElement("h3",{className:"cev-portlet__head-title cev-font-primary"},"B\xfasqueda por tiempo"))),u.a.createElement("div",{className:"cev-portlet__body"},u.a.createElement(re,{addQuery:function(t){return e.props.addQuery(t)}})))))}}]),a}(u.a.Component),ce=Object(d.b)((function(e){return{user:e.auth.user._id,showSearchBar:e.app.showSearch}}))(se),le=a(8),ue=a(974),de=a(2138),he=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={annotations:null,entitiesTree:null,documentText:null,entitiesColorMap:null,showEntities:!1},n.toggleEntities=n.toggleEntities.bind(Object(i.a)(n)),n}return Object(o.a)(a,[{key:"componentDidMount",value:function(){var e=this;(function(){var e={method:"GET",headers:new Headers({"Content-Type":"application/json",Authorization:Object(F.c)()}),mode:"cors",cache:"default"};return fetch(M.i+"/api/viz/getEtiquetas",e).then((function(e){if(200!==e.status)return Promise.reject(e.status);var t=e.json();return console.log(t),t}))})().then((function(t){console.log(t);var a=P.a.map(P.a.sortBy(t.aggregations.tipo.etiquetas.buckets,"key"),"key"),n=e.createEntitiesColorMap(a.map((function(e){return JSON.parse('"'.concat(e,'"'))})),M.a),r=e.createEntitiesTree(a.map((function(e){return JSON.parse('"'.concat(e,'"'))})),n);e.setState({entitiesColorMap:n,entitiesTree:r,entitiesList:a})})),this.props.showSearch(!0),this.props.showSearchTags(!1),this.props.fromComponent("metadata-tesauro")}},{key:"componentWillUnmount",value:function(){this.props.showSearch(!1),this.props.showSearchTags(!1),this.props.fromComponent("")}},{key:"createEntitiesTree",value:function(e,t){var a=[];return e.forEach((function(e,n){var r=a,o=e.split(" - ");"Entidades"!==o[0]&&o.forEach((function(a,o){if(a&&void 0!==r){var i=r.find((function(e){return e.text===a}));i||(i=r.push({id:n,text:a,state:{opened:!1,selected:!1},icon:"fas fa-square",children:[],data:'etiquetado:"'+e+'"',a_attr:{href:'/search?from=1&q=etiquetado:"'.concat(e,'"'),style:"color: ".concat(t[e])}})),r=i.children}}))})),{core:{data:a,expand_selected_onload:!1,themes:{dots:!1}},plugins:[],checkbox:{three_state:!0}}}},{key:"createEntitiesColorMap",value:function(e,t){return e.reduce((function(e,a,n){return Object(k.a)(Object(k.a)({},e),{},Object(le.a)({},a,t[n%t.length]))}),{})}},{key:"handleNodeSelection",value:function(e,t){var a=t.event.target,n=t.node.a_attr.href,r=t.node.data;"a"===a.tagName.toLowerCase()&&"#"!==n&&(this.props.filters({filters:{keyword:r,resourceGroup:{resourceGroupText:"",resourceGroupIDS:""},mapPolygon:""}}),this.props.addQuery(r))}},{key:"toggleEntities",value:function(){this.setState({showEntities:!this.state.showEntities})}},{key:"render",value:function(){var e=this,t=this.state.entitiesTree;return u.a.createElement(u.a.Fragment,null,t&&u.a.createElement(de.a,null,u.a.createElement(de.a.Header,{className:"text-center"},"Etiquetas"),u.a.createElement(de.a.Body,null,u.a.createElement(ue.a,{treeData:t,onNodeSelected:function(t,a){return e.handleNodeSelection(t,a)}}))),!t&&u.a.createElement(u.a.Fragment,null,u.a.createElement(G.a,{fluid:!0,className:"my-5"},u.a.createElement(O.a,{variant:"success"},u.a.createElement("div",{className:"alert-icon"},u.a.createElement("i",{className:"fas fa-sync fa-spin"})),u.a.createElement("div",{className:"alert-text"},"Cargando etiquetas ...")))))}}]),a}(l.Component),me=Object(d.b)((function(e){return{user:e.auth.user}}),p.a)(he),pe=a(1514),fe=a.n(pe),ge=a(1515),ve=a.n(ge),be=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).handleSync=function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return function(){for(var n=this,r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];clearTimeout(t),t=setTimeout((function(){return e.apply(n,o)}),a)}}((function(e){e.update()}),1e3),n.state={newLabel:"",show:!1,alert:!1,form:void 0,isLoading:!1},n}return Object(o.a)(a,[{key:"componentDidMount",value:function(){this.setState({oldLabel:this.props.label,newLabel:this.props.label,show:!1})}},{key:"selectForm",value:function(e){var t=this,a=this.props.config.forms[e.target.value];void 0!==a?"form-select"===a.type?g.h(a.field).then((function(e){e.aggregations.options.buckets.length>0?a.schema.properties[a.name].enum=P.a.map(e.aggregations.options.buckets,"key"):a.schema.properties[a.name].enum=["Sin Registros"],a.schema.properties[a.name].enum=a.schema.properties[a.name].enum.sort(),t.setState({form:a})})):this.setState({form:a}):this.setState({form:null})}},{key:"onSubmit",value:function(e,t){t.preventDefault();var a=this.state.form.queryAlias?this.state.form.queryAlias:this.state.form.query;if("object"===typeof e)for(var n in e)"Sin Registros"!==e[n]&&(a=a.split("["+n+"]").join(e[n]));else a=e;a!==this.state.form.query&&this.setState({query:a,formData:e,show:!1,form:void 0},this.props.addQuery(a))}},{key:"asyncSearch",value:function(e){var t=this;this.setState({isLoading:!0}),g.f(this.state.form,e).then((function(e){t.setState({isLoading:!1,options:e.items})}))}},{key:"mapSelect",value:function(e){this.setState({mapData:e})}},{key:"mapAdd",value:function(){var e="",t="";P.a.map(this.state.mapData.features,(function(a,n){e+=t+a.geometry.type[0]+"_";var r="";P.a.map(a.geometry.coordinates,(function(t,a){e+=r+t,r="-"})),t="|"})),this.setState({show:!1,form:void 0},this.props.addMap(this.state.mapData,e))}},{key:"render",value:function(){var e=this,t=this.state.show,a=this.props.showSearchBar?"":"cev-advancedform";return u.a.createElement(y.a,{drop:"down",show:t,onToggle:function(){e.setState({show:!1})}},u.a.createElement(y.a.Toggle,{as:w,onClick:function(){e.setState({show:!0})}},u.a.createElement("button",{type:"button",className:"btn-small ml-2 btn btn-primary",title:"B\xfasqueda por etiquetas"},u.a.createElement(ve.a,null))),u.a.createElement(y.a.Menu,{flip:"false",className:"dropdown-menu-fit dropdown-menu-left dropdown-menu-anim dropdown-menu-xl ".concat(a," advanceSearch")},u.a.createElement("div",{className:"cev-portlet"},u.a.createElement("div",{className:"cev-portlet__head-title"},u.a.createElement("h3",null,"B\xfasqueda por etiquetas"),u.a.createElement("button",{type:"button",className:"btn-small ml-2 btn btn-danger",onClick:function(){e.setState({show:!1})}},u.a.createElement(V.a,null))),u.a.createElement("div",{className:"cev-portlet__body"},u.a.createElement(fe.a,{className:"cev-scroll",options:{wheelSpeed:1,wheelPropagation:!1},style:{height:"300px"},"data-scroll":"true",onSync:this.handleSync},u.a.createElement("div",{className:"cev-portlet"},u.a.createElement(me,{addQuery:this.props.addQuery})))))))}}]),a}(u.a.Component),ye=Object(d.b)((function(e){return{user:e.auth.user._id,showSearchBar:e.app.showSearch}}))(be),Ee=(a(1375),function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(o.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;return u.a.createElement("div",{className:"AdvancedSearchForm"},u.a.createElement("span",{className:"buttons"},u.a.createElement("button",{title:"agregar condicional OR",type:"button",className:"btn-small ml-2 btn btn-primary",onClick:function(t){return e.props.addQuery("OR")}},"OR"),u.a.createElement("button",{title:"agregar condicional AND",type:"button",className:"btn-small ml-2 btn btn-primary",onClick:function(t){return e.props.addQuery("AND")}},"AND")),u.a.createElement(K,{config:this.props.config,addQuery:this.props.addQuery}),this.props.dashboard&&u.a.createElement(Y,{config:this.props.config,addQuery:this.props.addQuery,addMap:this.props.addMap}),u.a.createElement(ye,{config:this.props.config,addQuery:this.props.addQuery}),u.a.createElement(u.a.Fragment,null,u.a.createElement(ce,{config:this.props.config,addQuery:this.props.addQuery})))}}]),a}(l.Component)),je=a(1245),Se=a(1516),Oe=a.n(Se),we=(a(2150),a(2129),a(516),a(886),function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e))._renderItems=function(e,t,a){return[null!==e.parent?u.a.createElement("div",{key:e.id,className:"d-flex flex-column flex-grow-1 font-weight-bold"},u.a.createElement("span",{className:"text-dark text-hover-primary mb-1 font-size-lg"},e.text),u.a.createElement("small",{className:"text-muted"},e.sublevel)):u.a.createElement("div",{key:e.id,className:"d-flex flex-column flex-grow-1 font-weight-bold"},u.a.createElement("span",{href:"#",className:"text-dark text-hover-primary mb-1 font-size-lg"},e.text))]},n.state={ResourceGroup:[],open:!1,advancedSearchConfig:void 0,mapQuery:void 0,filters:[],currentPosition:0,showTime:!1,currentKey:null,query:"",mapPlace:void 0},n.TypeaheadRef=u.a.createRef(),n.ResourceGroup=n.ResourceGroup.bind(Object(i.a)(n)),n.deleteTag=n.deleteTag.bind(Object(i.a)(n)),n}return Object(o.a)(a,[{key:"componentDidMount",value:function(){this.ResourceGroup(),this.AdvancedSearhConfig()}},{key:"AdvancedSearhConfig",value:function(){var e=this;g.d().then((function(t){e.setState({advancedSearchConfig:t})}),(function(e){console.log(e)}))}},{key:"ResourceGroup",value:function(){var e=this;f.f("").then((function(t){var a=[];t.forEach((function(e){e.children.length>0?e.children.forEach((function(t){t.sublevel=e.text,a.push(t)})):a.push(e)})),e.setState({ResourceGroup:a})}),(function(e){Object(je.a)({error:e,text:"Se ha presentado un error al cargar la informaci\xf3n",confirmButtonText:"Aceptar",action:function(){}})}))}},{key:"getAllChildren",value:function(e){var t=[];return function e(a){a.children.length>0?(t.push.apply(t,Object(n.a)(a.resourceGroup)),a.children.forEach((function(t){e(t)}))):t.push.apply(t,Object(n.a)(a.resourceGroup))}(e),t}},{key:"addQuery",value:function(e,t,a){var n=this.state.currentPosition,r=this.state.filters;("AND"!==e&&"OR"!==e||(0===n?e="":"AND"!==r[n]&&"OR"!==r[n]&&"AND"!==r[n-1]&&"OR"!==r[n-1]||(e="")),e)&&(n===r.length?r.push(e):r.splice(n,0,e),a("searchValue",r.join(" ")),this.setState({filters:r,currentPosition:r.length}))}},{key:"addMap",value:function(e,t,a,n){this.setState({mapQuery:e,mapPlace:n}),a("map",t)}},{key:"removeMap",value:function(){this.setState({mapQuery:void 0})}},{key:"handleChangeInput",value:function(e){this.setState({query:e.target.value})}},{key:"handleKeyUP",value:function(e,t,a){if(13===e.which&&0!==e.target.value.length&&(this.setState({query:""}),this.addQuery(e.target.value,t,a)),'"'===e.key&&('"'===this.state.currentKey?this.setState({currentKey:null}):this.setState({currentKey:e.key})),32===e.which&&'"'!==this.state.currentKey&&(e.preventDefault(),this.addQuery(e.target.value,t,a),this.setState({query:""})),-1!==[8,37,39,46].indexOf(e.which)&&0===e.target.value.length){var n=this.state.currentPosition;8===e.which&&n>0&&this.deleteTag(n-1,t,a),37===e.which&&this.setState({currentPosition:0===n?0:n-1}),39===e.which&&this.setState({currentPosition:n===this.state.filters.length?this.state.filters.length:n+1}),46===e.which&&n<this.state.filters.length&&this.deleteTag(n,t,a)}}},{key:"deleteTag",value:function(e,t,a){var n=this.state.filters;n.splice(e,1),a("searchValue",n.join(" ")),this.setState({filters:n,currentPosition:n.length})}},{key:"toggleTime",value:function(){this.setState({showTime:!this.state.showTime})}},{key:"render",value:function(){var e=this;return u.a.createElement(u.a.Fragment,null,this.state.ResourceGroup.length>0&&u.a.createElement(m.c,{enableReinitialize:!0,initialValues:{searchValue:"",searchResourceGroup:[],map:""},validate:function(t){var a={};return""===e.state.query&&(t.searchValue||0!==t.searchResourceGroup.length||t.map||(a.validate="Debe ingresar un par\xe1metro de b\xfasqueda, seleccionar un fondo o seleccionar un area georreferenciada")),a},onSubmit:function(t){var a=t.searchResourceGroup.children&&t.searchResourceGroup.children.length>0?t.searchResourceGroup.children.join(","):"",n=t.searchResourceGroup.text&&t.searchResourceGroup.text.length>0?t.searchResourceGroup.text.join(","):"",r="from="+encodeURIComponent(1),o="";(t.searchValue||""!==e.state.query)&&("OR"!==(o=t.searchValue.split(" "))[o.length-1]&&"AND"!==o[o.length-1]||o.pop(),t.searchValue=o.join(" ")+" "+e.state.query,o="q="+encodeURIComponent(t.searchValue)),e.props.fromComponent("search"),e.props.filters({filters:{keyword:t.searchValue,resourceGroup:{resourceGroupText:n,resourceGroupIDS:a},mapPolygon:t.map?t.map:""}}),o?e.props.history.push("/search?"+o+"&"+r):e.props.history.push("/search?"+r)}},(function(t){var a=t.values,n=t.errors,r=t.touched,o=(t.handleChange,t.handleBlur,t.handleSubmit),i=(t.isSubmitting,t.setFieldValue);return u.a.createElement("div",null,u.a.createElement("form",{onSubmit:o},u.a.createElement("div",{className:"input-group"},u.a.createElement("div",{className:"input-group-prepend"}),u.a.createElement(b,{tags:e.state.filters,currentPosition:e.state.currentPosition,events:{onKeyDown:function(t){e.handleKeyUP(t,a,i)},deleteTag:function(t){e.deleteTag(t,a,i)},onChange:function(t){e.handleChangeInput(t)}}}),u.a.createElement("button",{type:"submit",className:"btn-small ml-2 btn btn-primary",disabled:!1},u.a.createElement(Oe.a,null)," Buscar")),e.state.mapPlace&&u.a.createElement("div",{className:"mapPlace"},u.a.createElement("i",{className:"flaticon2-map"}),"Mapa seleccionado: ",e.state.mapPlace),u.a.createElement("br",null)),u.a.createElement("div",{className:"resources-group-search resources-group-zindex"},e.state.advancedSearchConfig&&u.a.createElement(Ee,{dashboard:!0,className:"advanced-search-zindex",config:e.state.advancedSearchConfig,addQuery:function(t){return e.addQuery(t,a,i)},addMap:function(t,a,n){return e.addMap(t,a,i,n)}}),u.a.createElement("div",{className:"resources-group-list"},u.a.createElement(v.a,{id:"resources-group",labelKey:"text",clearButton:!0,multiple:!0,options:e.state.ResourceGroup.filter((function(e){return!["001-ERR","000-ERR"].includes(e.parent)})),renderMenuItemChildren:e._renderItems,placeholder:"Selecciona un fondo",searchText:"Cargando fondos",promptText:"Buscar fondos",emptyLabel:"No se encontraron fondos",onChange:function(t){var a=t.map((function(t,a){return e.getAllChildren(t)})),n=t.map((function(e,t){return e.text}));i("searchResourceGroup",{children:a,text:n})},open:e.state.open,onBlur:function(){return e.setState({open:!1})},onFocus:function(){return e.setState({open:!0})},ref:e.TypeaheadRef}))),u.a.createElement("br",null),u.a.createElement("div",{className:"text-center"},u.a.createElement("span",{className:"badge badge-danger"},n.validate&&(r.searchValue||r.searchResourceGroup)&&n.validate)))})))}}]),a}(l.Component));Object(h.o)(Object(d.b)(null,p.a)(we))},1375:function(e,t,a){},1377:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return i}));var n=a(40),r=a(43);a(179);function o(e){var t={method:"POST",headers:new Headers({"Content-Type":"application/json",Authorization:Object(r.c)()}),mode:"cors",cache:"default",body:JSON.stringify(e)};return fetch(n.i+"/api/resources/getAllResources",t).then((function(e){return 200!==e.status?Promise.reject(e.status):e.json()}))}function i(e){var t={method:"DELETE",headers:new Headers({Authorization:Object(r.c)()}),mode:"cors",cache:"default"};return fetch(n.i+"/api/resources/"+e,t).then((function(e){return 200!==e.status?Promise.reject(e.status):e.json()}))}},2108:function(e,t,a){"use strict";a.r(t);var n=a(35),r=a(2),o=a.n(r),i=(a(1315),a(56)),s=a(151),c=(a(1377),a(1290));t.default=Object(i.b)(null,s.a)((function(e){var t=Object(r.useState)("Aqu\xed Gran Total"),a=Object(n.a)(t,2);return a[0],a[1],o.a.createElement("div",{className:"cev-dashboard"},o.a.createElement(c.a,null))}))},963:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"h",(function(){return i})),a.d(t,"g",(function(){return s})),a.d(t,"a",(function(){return c})),a.d(t,"e",(function(){return l})),a.d(t,"i",(function(){return u})),a.d(t,"f",(function(){return d})),a.d(t,"c",(function(){return h})),a.d(t,"d",(function(){return m}));var n=a(43),r=a(40);function o(e,t){var a="/resources/"+e;var o={method:"POST",headers:new Headers({Authorization:Object(n.c)(),"Content-Type":"application/json"}),mode:"cors",cache:"default",body:t};return fetch(r.i+a,o).then((function(e){return 200!==e.status?Promise.reject(e):e.json()}))}function i(e){var t={method:"POST",headers:new Headers({Authorization:Object(n.c)()}),mode:"cors",cache:"default",body:e};return fetch(r.i+"/resources",t).then((function(e){return 201!==e.status?Promise.reject(e):e.json()}))}function s(e){var t={method:"POST",headers:new Headers({Authorization:Object(n.c)(),"Content-Type":"application/json"}),mode:"cors",cache:"default",body:e};return fetch(r.i+"/resources/tree",t).then((function(e){return 200!==e.status?Promise.reject(e):e.json()}))}function c(e){var t="/resources/"+e,a={method:"DELETE",headers:new Headers({Authorization:Object(n.c)()}),mode:"cors",cache:"default"};return fetch(r.i+t,a).then((function(e){return 200!==e.status?Promise.reject(e):e.json()}))}function l(e){var t="/resources/"+e,a={method:"GET",headers:new Headers({Authorization:Object(n.c)()}),mode:"cors",cache:"default"};return fetch(r.i+t,a).then((function(e){return 200!==e.status?Promise.reject(e):e.json()}))}function u(e,t){var a="/resources/"+e,o={method:"PUT",headers:new Headers({Authorization:Object(n.c)()}),mode:"cors",cache:"default",body:t};return fetch(r.i+a,o).then((function(e){return 200!==e.status?Promise.reject(e):e.json()}))}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=new Headers({Authorization:Object(n.c)(),"Content-Type":"application/json"}),o="/resources/"+e+"/records",i={method:"POST",headers:a,mode:"cors",cache:"default",body:JSON.stringify({page:t})};return fetch(r.i+o,i).then((function(e){return 200!==e.status?Promise.reject(e):e.json()}))}function h(e){var t={method:"POST",headers:new Headers({Authorization:Object(n.c)(),"Content-Type":"application/json"}),mode:"cors",cache:"default",body:e};return fetch(r.i+"/records",t).then((function(e){return 200!==e.status?Promise.reject(e):e.json()}))}function m(e){var t="/resources/"+e+"/imgs",a={method:"GET",headers:new Headers({Authorization:Object(n.c)(),"Content-Type":"application/json"}),mode:"cors",cache:"default"};return fetch(r.i+t,a).then((function(e){return 200!==e.status?Promise.reject(e):e.json()}))}},974:function(e,t,a){"use strict";a.d(t,"a",(function(){return M}));var n=a(35),r=a(2),o=a.n(r),i=(a(1004),a(1143),a(1144),a(516)),s=a(512),c=a(883),l=a(92),u=a(879),d=a(2133),h=a(882),m=a(881),p=a(880),f=a(345),g=a.n(f),v=a(1146),b=a.n(v),y=a(346),E=a.n(y),j=a(1147),S=a.n(j),O=a(963),w=a(1145),k=a.n(w),N=a(40),x=a(267),C=Object(s.a)((function(e){return{check:{padding:0},icon:{marginLeft:e.spacing(2),marginRight:e.spacing(1),minWidth:"auto","& path":{fill:"#56749a"}},text:{"& span":{display:"inline-block",padding:"0 10px",transition:"all 0.3s ease-in-out"},"&.selected span":{background:"#c5cfdc",borderRadius:"5px",color:"#375374"}}}})),T=function(e){var t=Object(r.useState)(!1),a=Object(n.a)(t,2),i=a[0],s=a[1],c=C(),l=Object(r.useState)(!1),h=Object(n.a)(l,2),f=h[0],g=h[1];Object(r.useEffect)((function(){if(Object(x.isArray)(e.path)){var t=e.path.find((function(t){return!!t&&t.id===e.id}));g(!!t)}}),[e.path]),Object(r.useEffect)((function(){if(e.selected)if(e.selected.length>0){var t=e.selected.find((function(t){return!!t&&t.id===e.id}));s(!!t)}else s(!1);else s(!1)}),[e.selected]);var v=function(){e.setFondo(e.original,e.parent)};return o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,{className:e.class},e.activeTypes.filter((function(t){return t.slug===e.original.post_type}))[0].direct&&o.a.createElement(d.a,{checked:i,className:c.check,edge:"start",color:"primary",onClick:function(){v()}}),o.a.createElement(p.a,{className:c.icon},N.h.filter((function(t){return t.value===e.original.icon}))?N.h.filter((function(t){return t.value===e.original.icon}))[0].iconlight:o.a.createElement(k.a,null)),o.a.createElement(m.a,{style:{cursor:"pointer"},onClick:function(){v()},primary:e.original.name,className:"".concat(c.text," ").concat(f||i?"selected":"")})))},_=Object(s.a)((function(e){return{root:{flexGrow:1,display:"flex",paddingTop:e.spacing(4)},check:{padding:0},accordeons:{flexGrow:1,paddingLeft:e.spacing(2),paddingRight:e.spacing(2)},listado:{flexGrow:1,paddingLeft:e.spacing(2),paddingRight:e.spacing(2),maxWidth:600},nested:{paddingLeft:e.spacing(3)+"px !important",marginLeft:e.spacing(1),borderLeft:"1px solid #dcdcdc"},icon:{marginLeft:e.spacing(2),marginRight:e.spacing(1),minWidth:"auto","&.loading":{"-webkit-animation":"rotate-center 1s linear infinite both",animation:"rotate-center 1s linear infinite both"},"& path":{fill:"#56749a"}},iconExpand:{marginRight:e.spacing(1),minWidth:"auto","& path":{fill:"#999"}},text:{"& span":{display:"inline-block",padding:"0 10px",transition:"all 0.3s ease-in-out"},"&.selected span":{background:"#c5cfdc",borderRadius:"5px",color:"#375374"}}}})),A=function e(t){var a=_(),i=Object(r.useState)(!1),s=Object(n.a)(i,2),f=s[0],v=s[1],y=Object(r.useState)(!1),j=Object(n.a)(y,2),w=j[0],k=j[1],C=Object(r.useState)(!1),A=Object(n.a)(C,2),R=A[0],P=A[1],D=Object(r.useState)(!1),M=Object(n.a)(D,2),F=M[0],G=M[1],L=Object(r.useState)([]),z=Object(n.a)(L,2),q=z[0],H=z[1],B=function(){v(!f)},Q=function(){return[].concat(Object(l.a)(t.parent),[{id:t.id,name:t.name}])};return Object(r.useEffect)((function(){0===q.length&&f&&(G(!0),O.g(JSON.stringify({root:t.id,tree:t.activeTypes})).then((function(e){H(e),G(!1)})))}),[f]),Object(r.useEffect)((function(){if(G(!1),Object(x.isArray)(t.path)){var e=t.path.find((function(e){return!!e&&e.id===t.id}));P(!!e),v(!!e)}}),[t.path]),Object(r.useEffect)((function(){t.selected?t.selected.length>0&&t.selected.filter((function(e){return e.id===t.original.id})).length>0?k(!0):k(!1):k(!1)}),[t.selected]),o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,{className:t.class},t.activeTypes.filter((function(e){return e.slug===t.original.post_type}))[0].direct&&o.a.createElement(d.a,{checked:w,color:"primary",edge:"start",className:a.check,onClick:function(){t.setFondo(t.original,t.parent)}}),F?o.a.createElement(p.a,{className:"loading ".concat(a.icon)},o.a.createElement(S.a,null)):o.a.createElement(o.a.Fragment,null,o.a.createElement(p.a,{className:a.icon},N.h.filter((function(e){return e.value===t.original.icon}))?N.h.filter((function(e){return e.value===t.original.icon}))[0].icon:o.a.createElement(b.a,null))),f&&!F?o.a.createElement(g.a,{style:{cursor:"pointer"},onClick:B,className:a.iconExpand}):o.a.createElement(o.a.Fragment,null,F?o.a.createElement(E.a,{className:a.iconExpand}):o.a.createElement(E.a,{style:{cursor:"pointer"},onClick:B,className:a.iconExpand})),o.a.createElement(m.a,{style:{cursor:"pointer"},className:"".concat(a.text," ").concat(R||w?"selected":""),primary:t.original.name,onClick:function(){t.setFondo(t.original,t.parent)}})),o.a.createElement(h.a,{in:f,timeout:"auto",unmountOnExit:!0},o.a.createElement(c.a,{component:"div",disablePadding:!0,className:t.class},q.map((function(n){return!0!==n.children?o.a.createElement(o.a.Fragment,null,o.a.createElement(T,{name:n.text,original:n,class:"".concat(t.class," ").concat(a.nested),setFondo:t.setFondo,fondo:t.fondo,id:n.id,parent:null!==t.parent?Q():[{id:t.id,name:t.name}],path:t.path,selected:t.selected,activeTypes:t.activeTypes})):o.a.createElement(o.a.Fragment,null,o.a.createElement(e,{name:n.text,class:"".concat(a.nested," ").concat(t.class),children:n.children,original:n,id:n.id,path:t.path,setFondo:t.setFondo,fondo:t.fondo,parent:null!==t.parent?Q():[{id:t.id,name:t.name}],activeTypes:t.activeTypes,selected:t.selected}))})))))},R=Object(s.a)((function(e){return{root:{flexGrow:1,display:"flex",paddingTop:e.spacing(4)},tabs:{},accordeons:{flexGrow:1,paddingLeft:e.spacing(2),paddingRight:e.spacing(2)},listado:{flexGrow:1,paddingLeft:e.spacing(2),paddingRight:e.spacing(2),maxWidth:600},nested:{paddingLeft:e.spacing(3),marginLeft:e.spacing(3),borderLeft:"1px solid #dcdcdc"},item:{padding:1}}})),P=function(e){var t=R();return o.a.createElement(i.a,{className:t.listado},o.a.createElement(c.a,{disablePadding:!0,component:"nav","aria-labelledby":"nested-list-subheader"},e.root.map((function(a){return!0===a.children?o.a.createElement(o.a.Fragment,null,o.a.createElement(A,{name:"".concat(a.text),children:a.children,id:a.id,original:a,setFondo:e.setFondo,setLoading:e.setLoading,fondo:e.fondo,class:t.item,parent:null,path:e.path,activeTypes:e.activeTypes,selected:e.selected})):o.a.createElement(o.a.Fragment,null,o.a.createElement(T,{id:a.id,name:a.text,original:a,setFondo:e.setFondo,fondo:e.fondo,parent:null,path:e.path,class:t.item,selected:e.selected,activeTypes:e.activeTypes}))}))))},D=a(522),M=function(e){var t=Object(r.useState)(0),a=Object(n.a)(t,2),i=(a[0],a[1],Object(r.useState)([])),s=Object(n.a)(i,2),c=s[0],l=s[1];return Object(r.useEffect)((function(){var t,a,n={root:e.root?e.root:"all",tree:e.parents};e.parents.length>0&&((null===(t=e.filters)||void 0===t?void 0:t.treeKeyword)&&""!==(null===(a=e.filters)||void 0===a?void 0:a.treeKeyword)?(n.keyword=e.filters.treeKeyword,Object(D.b)(JSON.stringify(n)).then((function(e){l(e)}))):Object(O.g)(JSON.stringify(n)).then((function(e){l(e)})))}),[e.parents,e.filters]),o.a.createElement("div",{style:{marginTop:10}},o.a.createElement(P,{root:c,path:e.path,selected:e.selected,setFondo:e.setFondo,activeTypes:e.activeTypes,childrenEditing:e.childrenEditing,setPath:e.setPath}))};t.b=M}}]);
//# sourceMappingURL=28.45e90888.chunk.js.map